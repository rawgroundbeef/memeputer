#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run build and test before push as a final check
echo "ğŸ”¨ Running final build and test check before push..."

# Get to repo root
cd "$(git rev-parse --show-toplevel)" || exit 1

# Run build for SDK (the main package we're working on)
cd packages/sdk && pnpm build || {
  echo "âŒ SDK build failed. Push aborted."
  exit 1
}

# Run tests for SDK
pnpm test:run || {
  echo "âŒ SDK tests failed. Push aborted."
  exit 1
}

# Run tests for CLI
cd ../../packages/cli && pnpm test:run || {
  echo "âŒ CLI tests failed. Push aborted."
  exit 1
}

# Run tests for marketputer example
cd ../../examples/marketputer && pnpm test:run || {
  echo "âŒ Marketputer tests failed. Push aborted."
  exit 1
}

echo "âœ… All checks passed! Pushing..."

